{"version":3,"sources":["Utils.tsx","Decrypter.tsx","KeyManager.tsx","Encrypter.tsx","App.tsx","index.tsx"],"names":["download","text","name","blob","Blob","type","link","document","createElement","href","URL","createObjectURL","click","remove","toClipboard","navigator","clipboard","writeText","Decrypter","props","useState","inputText","setInputText","decryptHelperText","setDecryptHelperText","decryptedText","setDecryptedText","decError","setDecError","useEffect","variant","className","component","title","keyPair","multiline","spellCheck","rows","onChange","event","target","value","window","crypto","subtle","decrypt","privateKey","Buffer","from","then","decrypted","result","TextDecoder","decode","Uint8Array","catch","reason","console","log","fullWidth","label","error","helperText","disabled","InputProps","readOnly","display","justifyContent","onClick","str2ab","str","buf","ArrayBuffer","length","bufView","i","strLen","charCodeAt","ab2str","a","String","fromCharCode","apply","extractPemContent","pem","header","footer","contentStart","indexOf","contentEnd","substring","importPrivateKey","pemContents","binaryDerString","atob","binaryDer","importKey","hash","importPublicKey","parseKeyPair","keyPairStr","Promise","all","publicKey","resolve","reject","input","accept","multiple","onchange","fileList","files","reader","FileReader","onload","readAsText","pemWrap","contents","exportKey","key","format","exported","exportedAsString","exportedAsBase64","btoa","exportPrivateKey","exportPublicKey","createFingerprint","digest","codePoints","Array","map","fromCodePoint","emojiencode","KeyManager","exportedPrivateKey","setExportedPrivateKey","exportedPublicKey","setExportedPublicKey","privateFingerprint","setPrivateFingerprint","publicFingerprint","setPublicFingerprint","saveEnabled","setSaveEnabled","setKeyPair","keyStrings","privKey","localStorage","setItem","keys","priv","pub","onKeyPairChange","localKeyPair","getItem","Card","CardContent","Box","Typography","alignItems","width","TextField","CardActions","Button","size","flexDirection","generateKey","modulusLength","publicExponent","undefined","isCryptoKeyPair","loadKeyPair","Encrypter","pubKeyStr","setPubKeyStr","pubKeyHelperText","setPubKeyHelperText","inputHelperText","setInputHelperText","pubError","setPubError","encryptedText","setEncryptedText","keyStr","encoded","TextEncoder","encode","encrypt","encrypted","App","prefersDarkMode","useMediaQuery","theme","React","useMemo","createMuiTheme","palette","ThemeProvider","CssBaseline","Container","maxWidth","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.4ffb6328.chunk.js","sourcesContent":["/**\n * Save text as a text file.\n */\nexport function download(text: string, name: string) {\n  const blob = new Blob([text], { type: 'text/plain' });\n  var link = document.createElement('a');\n  link.href = URL.createObjectURL(blob);\n  link.download = name;\n  link.click();\n  link.remove();\n}\n\n/**\n * Copy text to clipboard\n */\nexport function toClipboard(text: string) {\n  if (navigator.clipboard) {\n    navigator.clipboard.writeText(text);\n  }\n}\n","import React, { useState, useEffect } from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport { Box, TextField, Button } from '@material-ui/core';\nimport { Card, CardContent, CardActions } from '@material-ui/core';\nimport { toClipboard } from './Utils';\n\ninterface Props {\n  keyPair: CryptoKeyPair | null;\n}\n\nexport function Decrypter(props: Props) {\n  const [inputText, setInputText] = useState('');\n  const [decryptHelperText, setDecryptHelperText] = useState('');\n  const [decryptedText, setDecryptedText] = useState('');\n  const [decError, setDecError] = useState(false);\n  useEffect(() => {\n    setDecryptHelperText(decError ? 'Invalid input or key' : '');\n  }, [decError]);\n  function handleInputChange(\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,\n  ) {\n    const text = event?.target.value;\n    setInputText(text);\n    const keyPair = props.keyPair;\n    if (text === '') {\n      setDecryptedText('');\n      setDecError(false);\n      return;\n    }\n    if (keyPair !== null) {\n      window.crypto.subtle\n        .decrypt('RSA-OAEP', keyPair.privateKey, Buffer.from(text, 'base64'))\n        .then((decrypted) => {\n          const result = new TextDecoder('utf-8').decode(\n            new Uint8Array(decrypted),\n          );\n          setDecryptedText(result);\n          setDecError(false);\n        })\n        .catch((reason) => {\n          console.log(reason.name);\n          setDecryptedText('');\n          setDecError(true);\n        });\n    }\n  }\n  return (\n    <Card variant=\"outlined\">\n      <CardContent>\n        <Box className=\"vspacing\">\n          <Typography\n            variant=\"h5\"\n            component=\"h2\"\n            title={\n              props.keyPair !== null\n                ? 'Ready to decrypt'\n                : 'Not ready to decrypt: Key is not set'\n            }\n          >\n            🔓Decrypt\n            {props.keyPair !== null ? ' 🟢' : ' 🟠'}\n          </Typography>\n          <Box>\n            <TextField\n              multiline={true}\n              spellCheck={false}\n              rows={3}\n              onChange={handleInputChange}\n              variant=\"outlined\"\n              fullWidth={true}\n              label=\"Encrypted Text\"\n              error={decError}\n              helperText={decryptHelperText}\n            >\n              {inputText}\n            </TextField>\n          </Box>\n          <Box>\n            <TextField\n              disabled\n              multiline={true}\n              spellCheck={false}\n              rows={2}\n              variant=\"filled\"\n              fullWidth={true}\n              label=\"Decrypted text\"\n              InputProps={{\n                readOnly: true,\n              }}\n              value={decryptedText || ''}\n            ></TextField>\n          </Box>\n          <Box display=\"flex\" justifyContent=\"flex-end\">\n            <CardActions>\n              <Button\n                title=\"Copy decrypted text\"\n                disabled={decryptedText === ''}\n                onClick={(event) => toClipboard(decryptedText)}\n                variant=\"outlined\"\n              >\n                Copy\n              </Button>\n            </CardActions>\n          </Box>\n        </Box>\n      </CardContent>\n    </Card>\n  );\n}\n","import React, { useState } from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport { Box, Button, TextField } from '@material-ui/core';\nimport { Card, CardContent, CardActions } from '@material-ui/core';\nimport { download, toClipboard } from './Utils';\n\nconst isCryptoKeyPair = (\n  keyPair: CryptoKey | CryptoKeyPair,\n): keyPair is CryptoKeyPair => {\n  return (keyPair as CryptoKeyPair).privateKey !== undefined;\n};\n\n/**\nConvert a string into an ArrayBuffer\nfrom https://developers.google.com/web/updates/2012/06/How-to-convert-ArrayBuffer-to-and-from-String\n*/\nfunction str2ab(str: string) {\n  const buf = new ArrayBuffer(str.length);\n  const bufView = new Uint8Array(buf);\n  for (let i = 0, strLen = str.length; i < strLen; i++) {\n    bufView[i] = str.charCodeAt(i);\n  }\n  return buf;\n}\n\n/**\nConvert  an ArrayBuffer into a string\nfrom https://developers.google.com/web/updates/2012/06/How-to-convert-ArrayBuffer-to-and-from-String\n*/\nexport function ab2str(buf: ArrayBuffer) {\n  let a = new Uint8Array(buf);\n  return String.fromCharCode.apply(null, a as any);\n}\n\nfunction extractPemContent(pem: string, header: string, footer: string) {\n  const contentStart = pem.indexOf(header);\n  const contentEnd = pem.indexOf(footer);\n  const pemContents = pem.substring(contentStart + header.length, contentEnd);\n  return pemContents;\n}\n\nasync function importPrivateKey(pem: string) {\n  // fetch the part of the PEM string between header and footer\n  const pemHeader = '-----BEGIN PRIVATE KEY-----';\n  const pemFooter = '-----END PRIVATE KEY-----';\n  const pemContents = extractPemContent(pem, pemHeader, pemFooter);\n  // base64 decode the string to get the binary data\n  const binaryDerString = window.atob(pemContents);\n  // convert from a binary string to an ArrayBuffer\n  const binaryDer = str2ab(binaryDerString);\n\n  return window.crypto.subtle.importKey(\n    'pkcs8',\n    binaryDer,\n    {\n      name: 'RSA-OAEP',\n      hash: 'SHA-256',\n    },\n    true,\n    ['decrypt'],\n  );\n}\n\nexport async function importPublicKey(pem: string) {\n  // fetch the part of the PEM string between header and footer\n  const pemHeader = '-----BEGIN PUBLIC KEY-----';\n  const pemFooter = '-----END PUBLIC KEY-----';\n  const pemContents = extractPemContent(pem, pemHeader, pemFooter);\n  // base64 decode the string to get the binary data\n  const binaryDerString = window.atob(pemContents);\n  // convert from a binary string to an ArrayBuffer\n  const binaryDer = str2ab(binaryDerString);\n\n  return window.crypto.subtle.importKey(\n    'spki',\n    binaryDer,\n    {\n      name: 'RSA-OAEP',\n      hash: 'SHA-256',\n    },\n    true,\n    ['encrypt'],\n  );\n}\nasync function parseKeyPair(keyPairStr: string): Promise<CryptoKeyPair> {\n  return Promise.all([\n    importPrivateKey(keyPairStr),\n    importPublicKey(keyPairStr),\n  ]).then((keyPair) => ({ privateKey: keyPair[0], publicKey: keyPair[1] }));\n}\n\n/**\n * Open file dialog -> load text file and parse -> return keyPair\n */\nasync function loadKeyPair(): Promise<CryptoKeyPair> {\n  return new Promise((resolve, reject) => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = 'text/plain';\n    input.multiple = false;\n    function fileHandler(event: Event) {\n      const fileList = input.files;\n      if (fileList !== null && fileList.length > 0) {\n        const reader = new FileReader();\n        reader.onload = () => {\n          const keyStr = reader.result as string;\n          parseKeyPair(keyStr)\n            .then((keyPair) => resolve(keyPair))\n            .catch(() => reject());\n        };\n        reader.readAsText(fileList[0]);\n      } else {\n        reject();\n      }\n    }\n    input.onchange = fileHandler;\n    input.click();\n  });\n}\n\n/**\n * Wrap base64 encoded contents with pem header and footer.\n */\nfunction pemWrap(contents: string, label: string) {\n  return `-----BEGIN ${label}-----\\n${contents}\\n-----END ${label}-----`;\n}\n\n/**\n * Export key in pem format\n */\nasync function exportKey(\n  key: CryptoKey,\n  format: 'pkcs8' | 'raw' | 'spki',\n  label: string,\n) {\n  const exported = await window.crypto.subtle.exportKey(format, key);\n  const exportedAsString = ab2str(exported);\n  const exportedAsBase64 = window.btoa(exportedAsString);\n  return pemWrap(exportedAsBase64, label);\n}\n\nasync function exportPrivateKey(key: CryptoKey) {\n  return exportKey(key, 'pkcs8', 'PRIVATE KEY');\n}\n\nasync function exportPublicKey(key: CryptoKey) {\n  return exportKey(key, 'spki', 'PUBLIC KEY');\n}\n\nfunction emojiencode(buf: ArrayBuffer) {\n  const a = Array.from(new Uint8Array(buf));\n  const codePoints = a.map((value) => {\n    if (value <= 80) {\n      //🍀 to 🎏\n      return value + 0x1f340;\n    }\n    if (value <= 144) {\n      // 🐀 to 🐿\n      return value + 0x1f400 - 81;\n    }\n    if (value <= 176) {\n      // 👤 to 💃\n      return value + 0x1f464 - 145;\n    }\n    // 🗻 to 🙊\n    return value + 0x1f5fb - 177;\n  });\n  return String.fromCodePoint.apply(null, codePoints);\n}\n\nfunction createFingerprint(key: string) {\n  return window.crypto.subtle\n    .digest('SHA-256', str2ab(key))\n    .then((digest) => emojiencode(digest));\n}\ninterface Props {\n  onKeyPairChange: (keyPair: CryptoKeyPair) => void;\n}\n\nexport function KeyManager(props: Props) {\n  const [exportedPrivateKey, setExportedPrivateKey] = useState('');\n  const [exportedPublicKey, setExportedPublicKey] = useState('');\n  const [privateFingerprint, setPrivateFingerprint] = useState('');\n  const [publicFingerprint, setPublicFingerprint] = useState('');\n  const [saveEnabled, setSaveEnabled] = useState(false);\n\n  function setKeyPair(keyPair: CryptoKeyPair) {\n    Promise.all([\n      exportPrivateKey(keyPair.privateKey),\n      exportPublicKey(keyPair.publicKey),\n    ]).then((keyStrings) => {\n      const [privKey, publicKey] = keyStrings;\n      localStorage.setItem('keyPair', publicKey + '\\n' + privKey);\n      Promise.all([\n        createFingerprint(privKey),\n        createFingerprint(publicKey),\n      ]).then((keys) => {\n        const [priv, pub] = keys;\n        setExportedPrivateKey(privKey);\n        setExportedPublicKey(publicKey);\n        setPrivateFingerprint(priv);\n        setPublicFingerprint(pub);\n      });\n      setSaveEnabled(true);\n      props.onKeyPairChange(keyPair);\n    });\n  }\n  function generateKey() {\n    window.crypto.subtle\n      .generateKey(\n        {\n          name: 'RSA-OAEP',\n          modulusLength: 2048,\n          publicExponent: new Uint8Array([1, 0, 1]),\n          hash: 'SHA-256',\n        },\n        true,\n        ['encrypt', 'decrypt'],\n      )\n      .then((keyPair) => {\n        if (isCryptoKeyPair(keyPair)) {\n          console.log('New key pair is generated.');\n          setSaveEnabled(true);\n          setKeyPair(keyPair);\n        }\n      });\n  }\n  function importKeyPair() {\n    loadKeyPair()\n      .then((keyPair) => {\n        setKeyPair(keyPair);\n      })\n      .catch((error) => {\n        console.log(error);\n      });\n  }\n\n  (() => {\n    const localKeyPair = localStorage.getItem('keyPair');\n    if (\n      localKeyPair !== null &&\n      exportedPrivateKey === '' &&\n      exportedPublicKey === ''\n    ) {\n      console.log('Load key pair from localStorage');\n      parseKeyPair(localKeyPair).then((keyPair) => {\n        setKeyPair(keyPair);\n      });\n    }\n  })();\n\n  return (\n    <Card variant=\"outlined\">\n      <CardContent>\n        <Box className=\"vspacing\">\n          <Typography variant=\"h5\" component=\"h2\">\n            🗝️Your Key Pair\n          </Typography>\n          <Box\n            display=\"flex\"\n            justifyContent=\"space-between\"\n            alignItems=\"stretch\"\n          >\n            <Box width=\"30%\">\n              <Card variant=\"outlined\">\n                <CardContent>\n                  <TextField\n                    multiline={true}\n                    spellCheck={false}\n                    rows={2}\n                    variant=\"filled\"\n                    fullWidth={true}\n                    label=\"Public Key's Fingerprint\"\n                    InputProps={{\n                      readOnly: true,\n                    }}\n                    value={publicFingerprint || ''}\n                  />\n                </CardContent>\n                <Box display=\"flex\" justifyContent=\"flex-end\">\n                  <CardActions>\n                    <Button\n                      title=\"Copy public key\"\n                      disabled={!saveEnabled}\n                      onClick={() => toClipboard(exportedPublicKey)}\n                      size=\"small\"\n                      variant=\"outlined\"\n                    >\n                      Copy\n                    </Button>\n                  </CardActions>\n                </Box>\n              </Card>\n            </Box>\n            <Box width=\"30%\">\n              <Card variant=\"outlined\">\n                <CardContent>\n                  <TextField\n                    multiline={true}\n                    spellCheck={false}\n                    rows={2}\n                    variant=\"filled\"\n                    fullWidth={true}\n                    label=\"Private Key's Fingerprint\"\n                    InputProps={{\n                      readOnly: true,\n                    }}\n                    value={privateFingerprint || ''}\n                  />\n                </CardContent>\n              </Card>\n            </Box>\n            <Box\n              width=\"30%\"\n              display=\"flex\"\n              flexDirection=\"column\"\n              justifyContent=\"space-around\"\n            >\n              <Button onClick={generateKey} variant=\"outlined\">\n                Generate Key Pair\n              </Button>\n              <Button onClick={importKeyPair} variant=\"outlined\">\n                Load Key Pair\n              </Button>\n              <Button\n                disabled={!saveEnabled}\n                variant=\"outlined\"\n                onClick={() =>\n                  download(\n                    exportedPublicKey + '\\n' + exportedPrivateKey,\n                    'KeyPair.txt',\n                  )\n                }\n              >\n                Save Key Pair\n              </Button>\n            </Box>\n          </Box>\n        </Box>\n      </CardContent>\n    </Card>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport { Box, TextField, Button } from '@material-ui/core';\nimport { Card, CardContent, CardActions } from '@material-ui/core';\nimport { importPublicKey, ab2str } from './KeyManager';\nimport { toClipboard } from './Utils';\n\nexport function Encrypter() {\n  const [pubKeyStr, setPubKeyStr] = useState('');\n  const [pubKeyHelperText, setPubKeyHelperText] = useState('');\n  const [inputHelperText, setInputHelperText] = useState('');\n  const [pubError, setPubError] = useState(false);\n  // const [inputText, setInputText] = useState('');\n  const [encryptedText, setEncryptedText] = useState('');\n  useEffect(() => {\n    setPubKeyHelperText(pubError ? 'Invalid public key' : '');\n  }, [pubError]);\n  function handlePubKeyChange(\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,\n  ) {\n    const keyStr = event?.target.value;\n    setPubKeyStr(keyStr);\n    if (keyStr === '') {\n      setPubError(false);\n    } else {\n      importPublicKey(keyStr)\n        .then((key) => {\n          setPubError(false);\n        })\n        .catch((reason) => {\n          setPubError(true);\n        });\n    }\n  }\n  function handleInputChange(\n    event: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>,\n  ) {\n    const text = event?.target.value;\n    if (text.length > 190) {\n      setInputHelperText('Input text too long');\n      setEncryptedText('');\n      return;\n    }\n    if (text === '') {\n      setEncryptedText('');\n      return;\n    }\n    setInputHelperText('');\n    if (pubKeyStr !== '' && !pubError) {\n      importPublicKey(pubKeyStr).then((key) => {\n        const enc = new TextEncoder();\n        const encoded = enc.encode(text);\n        window.crypto.subtle\n          .encrypt(\n            {\n              name: 'RSA-OAEP',\n            },\n            key,\n            encoded,\n          )\n          .then((encrypted) => {\n            const exportedAsString = ab2str(encrypted);\n            const exportedAsBase64 = window.btoa(exportedAsString);\n            setEncryptedText(exportedAsBase64);\n          })\n          .catch((error) => console.log(error));\n      });\n    }\n  }\n  return (\n    <Card variant=\"outlined\">\n      <CardContent>\n        <Box className=\"vspacing\">\n          <Typography variant=\"h5\" component=\"h2\">\n            🔒Encrypt\n          </Typography>\n          <Box>\n            <TextField\n              error={pubError}\n              spellCheck={false}\n              multiline={true}\n              rows={4}\n              onChange={handlePubKeyChange}\n              variant=\"outlined\"\n              fullWidth={true}\n              label=\"Receivers Public Key\"\n              helperText={pubKeyHelperText}\n            />\n          </Box>\n          <Box>\n            <TextField\n              error={inputHelperText !== ''}\n              multiline={true}\n              spellCheck={false}\n              rows={2}\n              variant=\"outlined\"\n              onChange={handleInputChange}\n              fullWidth={true}\n              label=\"Text to encrypt\"\n              helperText={inputHelperText}\n            />\n          </Box>\n          <Box>\n            <TextField\n              disabled\n              multiline={true}\n              spellCheck={false}\n              rows={2}\n              variant=\"filled\"\n              fullWidth={true}\n              label=\"Encrypted text\"\n              InputProps={{\n                readOnly: true,\n              }}\n              value={encryptedText || ''}\n            ></TextField>\n          </Box>\n          <Box display=\"flex\" justifyContent=\"flex-end\">\n            <CardActions>\n              <Button\n                title=\"Copy encrypted text\"\n                disabled={encryptedText === ''}\n                onClick={(event) => toClipboard(encryptedText)}\n                variant=\"outlined\"\n              >\n                Copy\n              </Button>\n            </CardActions>\n          </Box>\n        </Box>\n      </CardContent>\n    </Card>\n  );\n}\n","import React, { useState } from 'react';\nimport Typography from '@material-ui/core/Typography';\nimport Container from '@material-ui/core/Container';\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport { KeyManager } from './KeyManager';\nimport { Encrypter } from './Encrypter';\nimport { Decrypter } from './Decrypter';\n\nfunction App() {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)');\n\n  const [keyPair, setKeyPair] = useState(null as CryptoKeyPair | null);\n\n  const theme = React.useMemo(\n    () =>\n      createMuiTheme({\n        palette: {\n          type: prefersDarkMode ? 'dark' : 'light',\n        },\n      }),\n    [prefersDarkMode],\n  );\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <div className=\"App\">\n        <header className=\"App-header\"></header>\n        <Container maxWidth=\"md\" className=\"vspacing\">\n          <Typography component=\"h1\" variant=\"h2\">\n            Webcrypto\n          </Typography>\n          <KeyManager onKeyPairChange={(keyPair) => setKeyPair(keyPair)} />\n          <Encrypter />\n          <Decrypter keyPair={keyPair} />\n        </Container>\n      </div>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}